import{j as e,r}from"./react-BiuXNknu.js";import{a as vt}from"./react-dom-CfHK4fGS.js";import{B as yt}from"./react-router-dom-D5Qldk1N.js";import{I as bt,n as T,_ as R}from"./react-hot-toast-D7pLUzze.js";import{l as jt}from"./socket.io-client-DjmPdrD_.js";import{L as Dt,a as Se,b as St,c as Nt,R as It,d as Lt,e as Rt,A as kt,f as Tt,P as ze,M as He,T as At,B as Ot,g as Ve,I as _t,G as Ft,h as Pt,i as Mt,j as ke,k as Ut,l as zt,m as Ht,n as Vt,o as Gt,p as $t,q as Yt,r as Jt,s as Wt,t as Bt}from"./react-icons-BFc2rPj3.js";import{v as Y}from"./uuid-CQkTLCs1.js";import{a as Ge}from"./axios-upsvKRUO.js";import{F as qt}from"./file-saver-BCfBrzKA.js";import{J as Xt}from"./jszip-D4ipYF5p.js";import{M as Qt}from"./react-markdown-0Hdmf8IN.js";import{h as Kt,d as Zt}from"./react-syntax-highlighter-CxifuYNv.js";import{I as en}from"./vscode-icons-js-DjHKlEgo.js";import{I as $e}from"./@iconify-DpqihcUK.js";import{c as oe}from"./classnames-DBzMARmP.js";import{l as Ye}from"./lang-map-DoPM27A7.js";import{a as tn,b as nn,c as sn,d as on,e as rn,f as an,g as ln,h as cn,i as dn,j as un,k as mn,l as fn,m as pn,n as hn,o as gn,p as xn,q as Cn,r as wn,s as En,t as vn,u as yn,v as bn,w as jn,x as Dn,y as Sn,z as Nn,A as In,B as Ln,C as Rn,D as kn,E as Tn,F as An,G as On,H as _n,I as Fn,J as Pn,K as Mn,L as Un,M as zn,N as Hn,O as Vn,P as Gn,Q as $n,R as Yn,S as Jn,T as Wn,U as Bn,V as qn}from"./@uiw-CQNEOd9W.js";import{A as Xn}from"./react-avatar-D_95QYwj.js";import{u as Ce,a as Qn,b as Je,c as Kn,d as Te}from"./react-router-CuGPxzb5.js";import{B as M,T as W,a as $,d as Zn,I as es,b as ts,c as ns,G as je,e as ss,f as os,g as rs,h as is,i as as,j as ls,k as cs,D as We,l as Be,m as qe,n as Xe,o as Ae}from"./@mui-sUc1mlS5.js";import{A as xe}from"./agora-rtc-sdk-ng-B00Ippza.js";import{S as ds}from"./react-split-DLsCAOtf.js";import{M as us}from"./react-tooltip-D5OLo8mZ.js";import{T as ms}from"./tldraw-DGASRv7q.js";import{u as fs}from"./@tldraw-ChCR2JRH.js";import"./lodash.isequal-CV6S-G1b.js";import"./lodash.throttle-13Tjp2C9.js";import"./idb-Bn1DMRyg.js";import"./lodash.uniq-DMBkMZk9.js";import"./core-js-Bd5YjKHi.js";import"./lz-string-DjWbGn3S.js";import"./hotkeys-js-BfWqkGRU.js";import{E as ps,bV as hs,bW as gs,bX as xs}from"./@codemirror-BP1aThgx.js";import{s as Oe}from"./screenfull-DmVOzVZz.js";import"./@babel-BgzKHD3d.js";import"./scheduler-CzFDRTuY.js";import"./@remix-run-DaH1AUis.js";import"./goober-vt3s6TGe.js";import"./engine.io-client-DBBxzneW.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./devlop-Cl3hj7Sz.js";import"./unified-BmnHnBXO.js";import"./bail-FqpXQuLt.js";import"./extend-DGwmeN5M.js";import"./is-plain-obj-C1gvLhAf.js";import"./trough-B_b8ryxu.js";import"./vfile-tbz-BywF.js";import"./vfile-message-Bq256rVA.js";import"./unist-util-stringify-position-Ch_qCilz.js";import"./remark-parse-DGN0zmaW.js";import"./mdast-util-from-markdown-pEYN4Rrr.js";import"./micromark-util-decode-numeric-character-reference-CNs1qBpV.js";import"./micromark-util-decode-string-strjl-tx.js";import"./decode-named-character-reference-C3-224fz.js";import"./micromark-util-normalize-identifier-C9ANKk3v.js";import"./micromark-m8Gu3KxW.js";import"./micromark-util-combine-extensions-Bka6Sc1c.js";import"./micromark-util-chunked-DrRIdSP-.js";import"./micromark-factory-space-CA-Wq7KA.js";import"./micromark-util-character-Ch8j4vtg.js";import"./micromark-core-commonmark-D5ehRGmS.js";import"./micromark-util-classify-character-GCpR5yWH.js";import"./micromark-util-resolve-all-PQCKh0dx.js";import"./micromark-util-subtokenize-BC4BSQ9J.js";import"./micromark-factory-destination-CkgxUJuk.js";import"./micromark-factory-label-U15tx9Nh.js";import"./micromark-factory-title-reCpaPbc.js";import"./micromark-factory-whitespace-_v4v79HM.js";import"./micromark-util-html-tag-name-DbKNfynz.js";import"./mdast-util-to-string-C_aolqmU.js";import"./remark-rehype-1Bk2Q172.js";import"./mdast-util-to-hast-BfaRxxVW.js";import"./@ungap-DDJC10qW.js";import"./micromark-util-sanitize-uri-WGc3xW3f.js";import"./unist-util-position-60F3QETU.js";import"./trim-lines-D8znQY54.js";import"./unist-util-visit-DGoE-dKL.js";import"./unist-util-visit-parents-BC5uWo4u.js";import"./unist-util-is-D9KQvrmg.js";import"./hast-util-to-jsx-runtime-BJkbO3Uo.js";import"./comma-separated-tokens-xMQ5YY98.js";import"./property-information-Bcl-LqRA.js";import"./space-separated-tokens-DD3iYX1K.js";import"./style-to-js-BtEmIoZW.js";import"./style-to-object-Db3lOIGb.js";import"./inline-style-parser-D--Rb2MU.js";import"./hast-util-whitespace-D4Wp6AEg.js";import"./estree-util-is-identifier-name-BgBfM8ME.js";import"./html-url-attributes-D46m5wfe.js";import"./refractor-DQ1wXE9G.js";import"./hastscript-CufpaJpy.js";import"./xtend-CeaPpq3n.js";import"./hast-util-parse-selector-Cqsfuk9Y.js";import"./@lezer-UEL4MdiS.js";import"./codemirror-lang-mermaid-BYN4Mizs.js";import"./@replit-TkkdufQq.js";import"./@nextjournal-BoE2xncH.js";import"./colors-named-CSGyx1iI.js";import"./colors-named-hex-Db6HdBCI.js";import"./hsl-matcher-CyxH9sTP.js";import"./core-js-pure-DvdCSAUB.js";import"./prop-types-BCypF0td.js";import"./is-retina-CcOIFDTM.js";import"./md5-B4RGlbSI.js";import"./crypt-cVg_o3mt.js";import"./charenc-CNUcYXLA.js";import"./is-buffer-DoLxFxiE.js";import"./@emotion-BXO6uz_F.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./stylis-BqmD5Vow.js";import"./react-transition-group-DjcIyBic.js";import"./split.js-CPyVEc61.js";import"./@floating-ui-KHiDlUlq.js";import"./@radix-ui-DrFNJHYg.js";import"./react-remove-scroll-C8OhlFdm.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-n1yCV30A.js";import"./react-style-singleton-YD3Aw4qT.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-BM8qeALW.js";import"./use-callback-ref-BebrxFK9.js";import"./aria-hidden-DQ5UC2Eg.js";import"./canvas-size-CezOLxoY.js";import"./@use-gesture-DcP8nEhY.js";import"./eventemitter3-6E4L_h32.js";import"./crelt-C8TCjufn.js";import"./style-mod-gVpFNjS1.js";import"./w3c-keyname-Vcq4gwWv.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(i){if(i.ep)return;i.ep=!0;const l=s(i);fetch(i.href,l)}})();function Cs(){return e.jsx(bt,{position:"top-right"})}var B=(t=>(t.CODING="coding",t.DRAWING="drawing",t))(B||{}),fe=(t=>(t.OFFLINE="offline",t.ONLINE="online",t))(fe||{}),H=(t=>(t.INITIAL="initial",t.CONNECTING="connecting",t.ATTEMPTING_JOIN="attempting-join",t.JOINED="joined",t.CONNECTION_FAILED="connection-failed",t.DISCONNECTED="disconnected",t))(H||{});const Qe=r.createContext(null),U=()=>{const t=r.useContext(Qe);if(t===null)throw new Error("useAppContext must be used within a AppContextProvider");return t};function ws({children:t}){const[n,s]=r.useState([]),[o,i]=r.useState(H.INITIAL),[l,c]=r.useState({username:"",roomId:""}),[d,a]=r.useState(null),[u,g]=r.useState(B.CODING),[h,m]=r.useState(null);return r.useEffect(()=>{l.roomId?a({id:l.roomId}):a(null)},[l.roomId]),e.jsx(Qe.Provider,{value:{users:n,setUsers:s,currentUser:l,setCurrentUser:c,status:o,setStatus:i,activityState:u,setActivityState:g,drawingData:h,setDrawingData:m,currentRoom:d,setCurrentRoom:a},children:t})}var x=(t=>(t.JOIN_REQUEST="join-request",t.JOIN_ACCEPTED="join-accepted",t.USER_JOINED="user-joined",t.USER_DISCONNECTED="user-disconnected",t.SYNC_FILE_STRUCTURE="sync-file-structure",t.DIRECTORY_CREATED="directory-created",t.DIRECTORY_UPDATED="directory-updated",t.DIRECTORY_RENAMED="directory-renamed",t.DIRECTORY_DELETED="directory-deleted",t.FILE_CREATED="file-created",t.FILE_UPDATED="file-updated",t.FILE_RENAMED="file-renamed",t.FILE_DELETED="file-deleted",t.USER_OFFLINE="offline",t.USER_ONLINE="online",t.SEND_MESSAGE="send-message",t.RECEIVE_MESSAGE="receive-message",t.TYPING_START="typing-start",t.TYPING_PAUSE="typing-pause",t.USERNAME_EXISTS="username-exists",t.REQUEST_DRAWING="request-drawing",t.SYNC_DRAWING="sync-drawing",t.DRAWING_UPDATE="drawing-update",t.VIDEO_CALL_STARTED="video-call-started",t.VIDEO_CALL_REQUEST="video-call-request",t.VIDEO_CALL_ACCEPTED="video-call-accepted",t.VIDEO_CALL_REJECTED="video-call-rejected",t.VIDEO_CALL_ENDED="video-call-ended",t))(x||{});const Ke=r.createContext(null),V=()=>{const t=r.useContext(Ke);if(!t)throw new Error("useSocket must be used within a SocketProvider");return t},Es="http://localhost:3000",vs=({children:t})=>{const{users:n,setUsers:s,setStatus:o,setCurrentUser:i,drawingData:l,setDrawingData:c}=U(),d=r.useMemo(()=>jt(Es,{reconnectionAttempts:5,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:2e4,autoConnect:!0,transports:["websocket","polling"],forceNew:!0}),[]),a=r.useCallback(f=>{console.error("Socket connection error:",f),o(H.CONNECTION_FAILED),T.dismiss(),T.error("Connection to server failed. Retrying..."),d.connected||d.connect()},[o,d]),u=r.useCallback(()=>{T.dismiss(),o(H.INITIAL),T.error("The username you chose already exists in the room. Please choose a different username.")},[o]),g=r.useCallback(({user:f,users:b})=>{i(f),s(b),T.dismiss(),o(H.JOINED),b.length>1&&T.loading("Syncing data, please wait...")},[i,o,s]),h=r.useCallback(({user:f})=>{T.success(`${f.username} left the room`),s(n.filter(b=>b.username!==f.username))},[s,n]),m=r.useCallback(({socketId:f})=>{d.emit(x.SYNC_DRAWING,{socketId:f,drawingData:l})},[l,d]),p=r.useCallback(({drawingData:f})=>{c(f)},[c]);return r.useEffect(()=>(d.on("connect_error",a),d.on("connect_failed",a),d.on(x.USERNAME_EXISTS,u),d.on(x.JOIN_ACCEPTED,g),d.on(x.USER_DISCONNECTED,h),d.on(x.REQUEST_DRAWING,m),d.on(x.SYNC_DRAWING,p),()=>{d.off("connect_error"),d.off("connect_failed"),d.off(x.USERNAME_EXISTS),d.off(x.JOIN_ACCEPTED),d.off(x.USER_DISCONNECTED),d.off(x.REQUEST_DRAWING),d.off(x.SYNC_DRAWING)}),[p,a,g,m,h,u,s,d]),e.jsx(Ke.Provider,{value:{socket:d},children:t})},Ze=r.createContext(null),Ne=()=>{const t=r.useContext(Ze);if(!t)throw new Error("useChatRoom must be used within a ChatContextProvider");return t};function ys({children:t}){const{socket:n}=V(),[s,o]=r.useState([]),[i,l]=r.useState(!1),[c,d]=r.useState(0);return r.useEffect(()=>(n.on(x.RECEIVE_MESSAGE,({message:a})=>{o(u=>[...u,a]),l(!0)}),()=>{n.off(x.RECEIVE_MESSAGE)}),[n]),e.jsx(Ze.Provider,{value:{messages:s,setMessages:o,isNewMessage:i,setIsNewMessage:l,lastScrollHeight:c,setLastScrollHeight:d},children:t})}function bs(t){const n=new Date(t);let s=n.getHours();const o=String(n.getMinutes()).padStart(2,"0"),i=s>=12?"PM":"AM";return s=s%12,s=s||12,`${s}:${o} ${i}`}function js(){const{currentUser:t}=U(),{socket:n}=V(),{setMessages:s}=Ne(),o=r.useRef(null),i=l=>{var d;l.preventDefault();const c=(d=o.current)==null?void 0:d.value.trim();if(c&&c.length>0){const a={id:Y(),message:c,username:t.username,timestamp:bs(new Date().toISOString())};n.emit(x.SEND_MESSAGE,{message:a}),s(u=>[...u,a]),o.current&&(o.current.value="")}};return e.jsxs("form",{onSubmit:i,className:"flex justify-between rounded-md border border-primary",children:[e.jsx("input",{type:"text",className:"w-full flex-grow rounded-md border-none bg-dark p-2 outline-none",placeholder:"Enter a message...",ref:o}),e.jsx("button",{className:"flex items-center justify-center rounded-r-md  bg-primary p-2 text-black",type:"submit",children:e.jsx(Dt,{size:24})})]})}function Ds(){const{messages:t,isNewMessage:n,setIsNewMessage:s,lastScrollHeight:o,setLastScrollHeight:i}=Ne(),{currentUser:l}=U(),c=r.useRef(null),d=a=>{const u=a.target;i(u.scrollTop)};return r.useEffect(()=>{c.current&&(c.current.scrollTop=c.current.scrollHeight)},[t]),r.useEffect(()=>{n&&s(!1),c.current&&(c.current.scrollTop=o)},[n,s,o]),e.jsx("div",{className:"flex-grow overflow-auto rounded-md bg-darkHover p-2",ref:c,onScroll:d,children:t.map((a,u)=>e.jsxs("div",{className:"mb-2 w-[80%] self-end break-words rounded-md bg-dark px-3 py-2"+(a.username===l.username?" ml-auto ":""),children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs text-primary",children:a.username}),e.jsx("span",{className:"text-xs text-white",children:a.timestamp})]}),e.jsx("p",{className:"py-1",children:a.message})]},u))})}function re(){const[t,n]=r.useState({width:window.innerWidth,height:window.innerHeight}),[s,o]=r.useState(window.innerWidth<768);return r.useEffect(()=>{const i=()=>{n({width:window.innerWidth,height:window.innerHeight}),o(window.innerWidth<768)};return window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i)}},[]),{...t,isMobile:s}}function G(){const[t,n]=r.useState(!1),{height:s,isMobile:o}=re(),[i,l]=r.useState(s);return r.useEffect(()=>{s<500&&o?(n(!0),l(s)):o?(n(!1),l(s-50)):(n(!1),l(s))},[s,o,i]),{viewHeight:i,minHeightReached:t}}const Ss=()=>{const{viewHeight:t}=G();return e.jsxs("div",{className:"flex max-h-full min-h-[400px] w-full flex-col gap-2 p-4",style:{height:t},children:[e.jsx("h1",{className:"view-title",children:"Group Chat"}),e.jsx(Ds,{}),e.jsx(js,{})]})},Ns="https://text.pollinations.ai",Is=Ge.create({baseURL:Ns,headers:{"Content-Type":"application/json"}}),et=r.createContext(null),Ls=()=>{const t=r.useContext(et);if(t===null)throw new Error("useCopilot must be used within a CopilotContextProvider");return t},Rs=({children:t})=>{const[n,s]=r.useState(""),[o,i]=r.useState(""),[l,c]=r.useState(!1),d=async()=>{try{if(n.length===0){R.error("Please write a prompt");return}R.loading("Generating code..."),c(!0);const a=await Is.post("/",{messages:[{role:"system",content:"You are a code generator copilot for project named CodeChoreo. Generate code based on the given prompt without any explanation. Return only the code, formatted in Markdown using the appropriate language syntax (e.g., js for JavaScript, py for Python). Do not include any additional text or explanations. If you don't know the answer, respond with 'I don't know'."},{role:"user",content:n}],model:"mistral",private:!0});if(a.data){R.success("Code generated successfully");const u=a.data;u&&i(u)}c(!1),R.dismiss()}catch(a){console.error(a),c(!1),R.dismiss(),R.error("Failed to generate the code")}};return e.jsx(et.Provider,{value:{setInput:s,output:o,isRunning:l,generateCode:d},children:t})},ks=`function sayHi() {
  console.log("👋 Hello world");
}

sayHi()`,Ts={name:"root",id:Y(),type:"directory",children:[{id:Y(),type:"file",name:"index.js",content:ks}]},tt=(t,n)=>{if(t.id===n&&t.type==="directory")return t;if(t.type==="directory"&&t.children)for(const s of t.children){const o=tt(s,n);if(o)return o}return null},_e=(t,n)=>t.children?t.children.some(s=>s.name===n):!1,As=(t,n)=>{const s=o=>{if(o.id===n)return o;if(o.children)for(const i of o.children){const l=s(i);if(l)return l}return null};return s(t)},nt=t=>{if(t.type==="directory"&&t.children){let n=t.children.filter(o=>o.type==="directory");const s=t.children.filter(o=>o.type==="file");n.sort((o,i)=>o.name.localeCompare(i.name)),n=n.map(o=>nt(o)),s.sort((o,i)=>o.name.localeCompare(i.name)),t.children=[...n.filter(o=>o.name.startsWith(".")),...n.filter(o=>!o.name.startsWith(".")),...s.filter(o=>o.name.startsWith(".")),...s.filter(o=>!o.name.startsWith("."))]}return t},st=r.createContext(null),q=()=>{const t=r.useContext(st);if(!t)throw new Error("useFileSystem must be used within FileContextProvider");return t};function Os({children:t}){const{socket:n}=V(),{setUsers:s,drawingData:o}=U(),[i,l]=r.useState(Ts),c=i.children?i.children:[],[d,a]=r.useState(c),[u,g]=r.useState(d[0]),h=C=>{const w=E=>E.id===C?{...E,isOpen:!E.isOpen}:E.children?{...E,children:E.children.map(w)}:E;l(E=>w(E))},m=()=>{const C=w=>{var E;return{...w,isOpen:!1,children:(E=w.children)==null?void 0:E.map(C)}};l(w=>C(w))},p=r.useCallback((C,w,E=!0)=>{let y;typeof w=="string"?y={id:Y(),name:w,type:"directory",children:[],isOpen:!1}:y=w,C||(C=i.id);const j=D=>D.id===C?{...D,children:[...D.children||[],y]}:D.children?{...D,children:D.children.map(j)}:D;return l(D=>j(D)),E&&n.emit(x.DIRECTORY_CREATED,{parentDirId:C,newDirectory:y}),y.id},[i.id,n]),f=r.useCallback((C,w,E=!0)=>{C||(C=i.id);const y=j=>j.id===C?{...j,children:w}:j.children?{...j,children:j.children.map(y)}:j;l(j=>y(j)),a([]),g(null),C===i.id&&(T.dismiss(),T.success("Files and folders updated")),E&&n.emit(x.DIRECTORY_UPDATED,{dirId:C,children:w})},[i.id,n]),b=r.useCallback((C,w,E=!0)=>{const y=D=>D.type==="directory"&&D.children?D.children.some(I=>I.type==="directory"&&I.name===w&&I.id!==C)?null:{...D,children:D.children.map(I=>{if(I.id===C)return{...I,name:w};if(I.type==="directory"){const Q=y(I);return Q!==null?Q:I}else return I})}:D,j=y(i);return j===null?!1:(l(j),E&&n.emit(x.DIRECTORY_RENAMED,{dirId:C,newDirName:w}),!0)},[n,l,i]),S=r.useCallback((C,w=!0)=>{const E=y=>{if(y.type==="directory"&&y.id===C)return null;if(y.children){const j=y.children.map(E).filter(D=>D!==null);return{...y,children:j}}else return y};l(y=>E(y)),w&&n.emit(x.DIRECTORY_DELETED,{dirId:C})},[n]),L=C=>{const w=As(i,C);w&&(_((u==null?void 0:u.id)||"",(u==null?void 0:u.content)||""),d.some(E=>E.id===C)||a(E=>[...E,w]),a(E=>E.map(y=>y.id===(u==null?void 0:u.id)?{...y,content:u.content||""}:y)),g(w))},A=C=>{if(C===(u==null?void 0:u.id)){_(u.id,u.content||"");const w=d.findIndex(E=>E.id===C);w!==-1&&d.length>1?w>0?g(d[w-1]):g(d[w+1]):g(null)}a(w=>w.filter(E=>E.id!==C))},P=r.useCallback((C,w,E=!0)=>{let y=1;C||(C=i.id);const j=tt(i,C);if(!j)throw new Error("Parent directory not found");let D;if(typeof w=="string"){let I=w,Q=_e(j,I);for(;Q;)I=`${I.split(".")[0]}(${y}).${I.split(".")[1]}`,Q=_e(j,I),y++;D={id:Y(),name:I,type:"file",content:""}}else D=w;const X=I=>I.id===j.id?{...I,children:[...I.children||[],D],isOpen:!0}:I.children?{...I,children:I.children.map(X)}:I;return l(I=>X(I)),a(I=>[...I,D]),g(D),E&&n.emit(x.FILE_CREATED,{parentDirId:C,newFile:D}),D.id},[i,n]),_=r.useCallback((C,w)=>{const E=y=>y.type==="file"&&y.id===C?{...y,content:w}:y.children?{...y,children:y.children.map(E)}:y;l(y=>E(y)),d.some(y=>y.id===C)&&a(y=>y.map(j=>j.id===C?{...j,content:w}:j))},[d]),F=r.useCallback((C,w,E=!0)=>{const y=j=>j.type==="directory"&&j.children?{...j,children:j.children.map(D=>D.type==="file"&&D.id===C?{...D,name:w}:D)}:j;return l(j=>y(j)),a(j=>j.map(D=>D.id===C?{...D,name:w}:D)),C===(u==null?void 0:u.id)&&g(j=>j?{...j,name:w}:null),E&&n.emit(x.FILE_RENAMED,{fileId:C,newName:w}),!0},[u==null?void 0:u.id,n]),k=r.useCallback((C,w=!0)=>{const E=y=>{if(y.type==="directory"&&y.children){const j=y.children.map(D=>D.type==="directory"?E(D):D.id!==C?D:null).filter(D=>D!==null);return{...y,children:j}}else return y};l(y=>E(y)),d.some(y=>y.id===C)&&a(y=>y.filter(j=>j.id!==C)),(u==null?void 0:u.id)===C&&g(null),T.success("File deleted successfully"),w&&n.emit(x.FILE_DELETED,{fileId:C})},[u==null?void 0:u.id,d,n]),ie=()=>{const C=new Xt,w=(E,y="")=>{const j=y+E.name+(E.type==="directory"?"/":"");if(E.type==="file")C.file(j,E.content||"");else if(E.type==="directory"&&E.children)for(const D of E.children)w(D,j)};if(i.type==="directory"&&i.children)for(const E of i.children)w(E);C.generateAsync({type:"blob"}).then(E=>{qt.saveAs(E,"download.zip")})},ae=r.useCallback(({user:C})=>{T.success(`${C.username} joined the room`),n.emit(x.SYNC_FILE_STRUCTURE,{fileStructure:i,openFiles:d,activeFile:u,socketId:C.socketId}),n.emit(x.SYNC_DRAWING,{drawingData:o,socketId:C.socketId}),s(w=>[...w,C])},[u,o,i,d,s,n]),pe=r.useCallback(({fileStructure:C,openFiles:w,activeFile:E})=>{l(C),a(w),g(E),T.dismiss()},[]),ee=r.useCallback(({parentDirId:C,newDirectory:w})=>{p(C,w,!1)},[p]),le=r.useCallback(({dirId:C,children:w})=>{f(C,w,!1)},[f]),J=r.useCallback(({dirId:C,newName:w})=>{b(C,w,!1)},[b]),ce=r.useCallback(({dirId:C})=>{S(C,!1)},[S]),he=r.useCallback(({parentDirId:C,newFile:w})=>{P(C,w,!1)},[P]),de=r.useCallback(({fileId:C,newContent:w})=>{_(C,w),(u==null?void 0:u.id)===C&&g({...u,content:w})},[u,_]),ue=r.useCallback(({fileId:C,newName:w})=>{F(C,w,!1)},[F]),ge=r.useCallback(({fileId:C})=>{k(C,!1)},[k]);return r.useEffect(()=>(n.once(x.SYNC_FILE_STRUCTURE,pe),n.on(x.USER_JOINED,ae),n.on(x.DIRECTORY_CREATED,ee),n.on(x.DIRECTORY_UPDATED,le),n.on(x.DIRECTORY_RENAMED,J),n.on(x.DIRECTORY_DELETED,ce),n.on(x.FILE_CREATED,he),n.on(x.FILE_UPDATED,de),n.on(x.FILE_RENAMED,ue),n.on(x.FILE_DELETED,ge),()=>{n.off(x.USER_JOINED),n.off(x.DIRECTORY_CREATED),n.off(x.DIRECTORY_UPDATED),n.off(x.DIRECTORY_RENAMED),n.off(x.DIRECTORY_DELETED),n.off(x.FILE_CREATED),n.off(x.FILE_UPDATED),n.off(x.FILE_RENAMED),n.off(x.FILE_DELETED)}),[ee,ce,J,le,he,ge,ue,pe,de,ae,n]),e.jsx(st.Provider,{value:{fileStructure:i,openFiles:d,activeFile:u,setActiveFile:g,closeFile:A,toggleDirectory:h,collapseDirectories:m,createDirectory:p,updateDirectory:f,renameDirectory:b,deleteDirectory:S,openFile:L,createFile:P,updateFileContent:_,renameFile:F,deleteFile:k,downloadFilesAndFolders:ie},children:t})}function _s(){const{socket:t}=V(),{viewHeight:n}=G(),{generateCode:s,output:o,isRunning:i,setInput:l}=Ls(),{activeFile:c,updateFileContent:d,setActiveFile:a}=q(),u=async()=>{try{const m=o.replace(/```[\w]*\n?/g,"").trim();await navigator.clipboard.writeText(m),R.success("Output copied to clipboard")}catch(m){R.error("Unable to copy output to clipboard"),console.log(m)}},g=()=>{if(c){const p=`${c.content?`${c.content}
`:""}${o.replace(/```[\w]*\n?/g,"").trim()}`;d(c.id,p),a({...c,content:p}),R.success("Code pasted successfully"),t.emit(x.FILE_UPDATED,{fileId:c.id,newContent:p})}},h=()=>{if(c){if(!confirm("Are you sure you want to replace the code in the file?"))return;const p=o.replace(/```[\w]*\n?/g,"").trim();d(c.id,p),a({...c,content:p}),R.success("Code replaced successfully"),t.emit(x.FILE_UPDATED,{fileId:c.id,newContent:p})}};return e.jsxs("div",{className:"flex max-h-full min-h-[400px] w-full flex-col gap-2 p-4",style:{height:n},children:[e.jsx("h1",{className:"view-title",children:"Copilot"}),e.jsx("textarea",{className:"min-h-[120px] w-full rounded-md border-none bg-darkHover p-2 text-white outline-none",placeholder:"What code do you want to generate?",onChange:m=>l(m.target.value)}),e.jsx("button",{className:"mt-1 flex w-full justify-center rounded-md bg-primary p-2 font-bold text-black outline-none disabled:cursor-not-allowed disabled:opacity-50",onClick:s,disabled:i,children:i?"Generating...":"Generate Code"}),o&&e.jsxs("div",{className:"flex justify-end gap-4 pt-2",children:[e.jsx("button",{title:"Copy Output",onClick:u,children:e.jsx(Se,{size:18,className:"cursor-pointer text-white"})}),e.jsx("button",{title:"Replace code in file",onClick:h,children:e.jsx(St,{size:18,className:"cursor-pointer text-white"})}),e.jsx("button",{title:"Paste code in file",onClick:g,children:e.jsx(Nt,{size:18,className:"cursor-pointer text-white"})})]}),e.jsx("div",{className:"h-full rounded-lg w-full overflow-y-auto p-0",children:e.jsx(Qt,{components:{code({inline:m,className:p,children:f,...b}){const S=/language-(\w+)/.exec(p||""),L=S?S[1]:"javascript";return m?e.jsx("code",{className:p,...b,children:f}):e.jsx(Kt,{style:Zt,language:L,PreTag:"pre",className:"!m-0 !h-full !rounded-lg !bg-gray-900 !p-2",children:String(f).replace(/\n$/,"")})},pre({children:m}){return e.jsx("pre",{className:"h-full",children:m})}},children:o})})]})}const ot=({ref:t})=>{const[n,s]=r.useState(!1),[o,i]=r.useState({x:0,y:0});return r.useEffect(()=>{const l=t.current;if(!l)return;const c=()=>{s(!1)},d=u=>{t.current&&t.current.contains(u.target)?(s(!0),i({x:u.pageX,y:u.pageY})):s(!1)},a=u=>{u.preventDefault(),s(!0),i({x:u.pageX,y:u.pageY})};return l.addEventListener("contextmenu",a),document.addEventListener("click",c),document.addEventListener("contextmenu",d),()=>{l.removeEventListener("contextmenu",a),document.removeEventListener("click",c),document.removeEventListener("contextmenu",d)}},[t]),{menuOpen:n,setMenuOpen:s,coords:o,setCoords:i}},rt=t=>{var o;return`vscode-icons:${(o=en.getIconForFile(t))==null?void 0:o.replace(/_/g,"-").split(".")[0]}`};function it({id:t,preName:n,setEditing:s,type:o}){const[i,l]=r.useState(n||""),{renameFile:c,openFile:d,renameDirectory:a}=q(),u=r.useRef(null),g=p=>{p.preventDefault(),p.stopPropagation();const f=o.charAt(0).toUpperCase()+o.slice(1);if(i==="")R.error(`${f} name cannot be empty`);else if(i.length>25)R.error(`${f} name cannot be longer than 25 characters`);else if(i===n)R.error(`${f} name cannot be the same as before`);else{const b=o==="directory"?a(t,i):c(t,i);b&&o==="file"&&d(t),b?s(!1):R.error(`${f} with same name already exists`)}},h=r.useCallback(p=>{var f;p.key==="Enter"?(f=u.current)==null||f.requestSubmit():p.key==="Escape"&&s(!1)},[s]),m=r.useCallback(p=>{const f=u.current;f&&!f.contains(p.target)&&s(!1)},[s]);return r.useEffect(()=>{const p=u.current;if(p)return p.focus(),p.addEventListener("keydown",h),document.addEventListener("keydown",m),document.addEventListener("click",m),()=>{p.removeEventListener("keydown",h),document.removeEventListener("keydown",m),document.removeEventListener("click",m)}},[m,h,s]),e.jsx("div",{className:"rounded-md",children:e.jsx("form",{onSubmit:g,ref:u,className:"flex w-full items-center gap-2 rounded-md",children:e.jsx("input",{type:"text",className:"w-full flex-grow rounded-sm bg-dark px-2 text-base text-white outline-none",autoFocus:!0,value:i,onChange:p=>l(p.target.value)})})})}function Fs(){const{fileStructure:t,createFile:n,createDirectory:s,collapseDirectories:o}=q(),i=r.useRef(null),[l,c]=r.useState(null),{minHeightReached:d}=G(),a=m=>{i.current&&!i.current.contains(m.target)&&c(t.id)},u=()=>{const m=prompt("Enter file name");if(m){const p=l||t.id;n(p,m)}},g=()=>{const m=prompt("Enter directory name");if(m){const p=l||t.id;s(p,m)}},h=nt(t);return e.jsxs("div",{onClick:a,className:"flex flex-grow flex-col",children:[e.jsxs("div",{className:"view-title flex justify-between",children:[e.jsx("h2",{children:"Files"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:u,title:"Create File",children:e.jsx(It,{size:20})}),e.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:g,title:"Create Directory",children:e.jsx(Lt,{size:20})}),e.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:o,title:"Collapse All Directories",children:e.jsx(Rt,{size:20})})]})]}),e.jsx("div",{className:oe("min-h-[200px] flex-grow overflow-auto pr-2 sm:min-h-0",{"h-[calc(80vh-170px)]":!d,"h-[85vh]":d}),ref:i,children:h.children&&h.children.map(m=>e.jsx(at,{item:m,setSelectedDirId:c},m.id))})]})}function at({item:t,setSelectedDirId:n}){const[s,o]=r.useState(!1),i=r.useRef(null),{coords:l,menuOpen:c,setMenuOpen:d}=ot({ref:i}),{deleteDirectory:a,toggleDirectory:u}=q(),g=p=>{n(p),u(p)},h=p=>{p.stopPropagation(),d(!1),o(!0)},m=(p,f)=>{p.stopPropagation(),d(!1),confirm("Are you sure you want to delete directory?")&&a(f)};return r.useEffect(()=>{const p=i.current;if(!p)return;p.tabIndex=0;const f=b=>{b.stopPropagation(),b.key==="F2"&&o(!0)};return p.addEventListener("keydown",f),()=>{p.removeEventListener("keydown",f)}},[]),t.type==="file"?e.jsx(Ps,{item:t,setSelectedDirId:n}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"flex w-full items-center rounded-md px-2 py-1 hover:bg-darkHover",onClick:()=>g(t.id),ref:i,children:[t.isOpen?e.jsx(kt,{size:24,className:"mr-2 min-w-fit"}):e.jsx(Tt,{size:24,className:"mr-2 min-w-fit"}),s?e.jsx(it,{id:t.id,preName:t.name,type:"directory",setEditing:o}):e.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:t.name,children:t.name})]}),e.jsx("div",{className:oe({hidden:!t.isOpen},{block:t.isOpen},{"pl-4":t.name!=="root"}),children:t.children&&t.children.map(p=>e.jsx(at,{item:p,setSelectedDirId:n},p.id))}),c&&e.jsx(Us,{handleDeleteDirectory:m,handleRenameDirectory:h,id:t.id,left:l.x,top:l.y})]})}const Ps=({item:t,setSelectedDirId:n})=>{const{deleteFile:s,openFile:o}=q(),[i,l]=r.useState(!1),{setIsSidebarOpen:c}=Ee(),{isMobile:d}=re(),{activityState:a,setActivityState:u}=U(),g=r.useRef(null),{menuOpen:h,coords:m,setMenuOpen:p}=ot({ref:g}),f=L=>{i||(n(L),o(L),d&&c(!1),a===B.DRAWING&&u(B.CODING))},b=L=>{L.stopPropagation(),l(!0),p(!1)},S=(L,A)=>{L.stopPropagation(),p(!1),confirm("Are you sure you want to delete file?")&&s(A)};return r.useEffect(()=>{const L=g.current;if(!L)return;L.tabIndex=0;const A=P=>{P.stopPropagation(),P.key==="F2"&&l(!0)};return L.addEventListener("keydown",A),()=>{L.removeEventListener("keydown",A)}},[]),e.jsxs("div",{className:"flex w-full items-center rounded-md px-2 py-1 hover:bg-darkHover",onClick:()=>f(t.id),ref:g,children:[e.jsx($e,{icon:rt(t.name),fontSize:22,className:"mr-2 min-w-fit"}),i?e.jsx(it,{id:t.id,preName:t.name,type:"file",setEditing:l}):e.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:t.name,children:t.name}),h&&e.jsx(Ms,{top:m.y,left:m.x,id:t.id,handleRenameFile:b,handleDeleteFile:S})]})},Ms=({top:t,left:n,id:s,handleRenameFile:o,handleDeleteFile:i})=>e.jsxs("div",{className:"absolute z-10 w-[150px] rounded-md border border-darkHover bg-dark p-1",style:{top:t,left:n},children:[e.jsxs("button",{onClick:o,className:"flex w-full items-center gap-2 rounded-md px-2 py-1 hover:bg-darkHover",children:[e.jsx(ze,{size:18}),"Rename"]}),e.jsxs("button",{onClick:l=>i(l,s),className:"flex w-full items-center gap-2 rounded-md px-2 py-1 text-danger hover:bg-darkHover",children:[e.jsx(He,{size:20}),"Delete"]})]}),Us=({top:t,left:n,id:s,handleRenameDirectory:o,handleDeleteDirectory:i})=>e.jsxs("div",{className:"absolute z-10 w-[150px] rounded-md border border-darkHover bg-dark p-1",style:{top:t,left:n},children:[e.jsxs("button",{onClick:o,className:"flex w-full items-center gap-2 rounded-md px-2 py-1 hover:bg-darkHover",children:[e.jsx(ze,{size:18}),"Rename"]}),e.jsxs("button",{onClick:l=>i(l,s),className:"flex w-full items-center gap-2 rounded-md px-2 py-1 text-danger hover:bg-darkHover",children:[e.jsx(He,{size:20}),"Delete"]})]});function zs(){const{downloadFilesAndFolders:t,updateDirectory:n}=q(),{viewHeight:s}=G(),{minHeightReached:o}=G(),[i,l]=r.useState(!1),c=async()=>{try{if(l(!0),"showDirectoryPicker"in window){const h=await window.showDirectoryPicker();await d(h);return}if("webkitdirectory"in HTMLInputElement.prototype){const h=document.createElement("input");h.type="file",h.webkitdirectory=!0,h.onchange=async m=>{const p=m.target.files;if(p){const f=await u(p);n("",f)}},h.click();return}T.error("Your browser does not support directory selection.")}catch(h){console.error("Error opening directory:",h),T.error("Failed to open directory")}finally{l(!1)}},d=async h=>{try{T.loading("Getting files and folders...");const m=await a(h);n("",m),T.dismiss(),T.success("Directory loaded successfully")}catch(m){console.error("Error processing directory:",m),T.error("Failed to process directory")}},a=async h=>{const m=[],p=["node_modules",".git",".vscode",".next"];for await(const f of h.values())if(f.kind==="file"){const b=await f.getFile(),S={id:Y(),name:f.name,type:"file",content:await g(b)};m.push(S)}else if(f.kind==="directory"){if(p.includes(f.name))continue;const b={id:Y(),name:f.name,type:"directory",children:await a(f),isOpen:!1};m.push(b)}return m},u=async h=>{const m=[],p=["node_modules",".git",".vscode",".next"];for(let f=0;f<h.length;f++){const b=h[f],S=b.webkitRelativePath.split("/");if(!S.some(L=>p.includes(L)))if(S.length>1){const L=S.slice(0,-1).join("/");if(m.findIndex(F=>F.name===L&&F.type==="directory")===-1){const F={id:Y(),name:L,type:"directory",children:[],isOpen:!1};m.push(F)}const P={id:Y(),name:b.name,type:"file",content:await g(b)},_=m.find(F=>F.name===L&&F.type==="directory");_&&_.children&&_.children.push(P)}else{const L={id:Y(),name:b.name,type:"file",content:await g(b)};m.push(L)}}return m},g=async h=>{if(h.size>1048576)return`File too large: ${h.name} (${Math.round(h.size/1024)}KB)`;try{return await h.text()}catch(p){return console.error(`Error reading file ${h.name}:`,p),`Error reading file: ${h.name}`}};return e.jsxs("div",{className:"flex select-none flex-col gap-1 px-4 py-2",style:{height:s,maxHeight:s},children:[e.jsx(Fs,{}),e.jsxs("div",{className:oe("flex min-h-fit flex-col justify-end pt-2",{hidden:o}),children:[e.jsx("hr",{}),e.jsxs("button",{className:"mt-2 flex w-full justify-start rounded-md p-2 transition-all hover:bg-darkHover",onClick:c,disabled:i,children:[e.jsx(At,{className:"mr-2",size:24}),i?"Loading...":"Open File/Folder"]}),e.jsxs("button",{className:"flex w-full justify-start rounded-md p-2 transition-all hover:bg-darkHover",onClick:t,children:[e.jsx(Ot,{className:"mr-2",size:22})," Download Code"]})]})]})}const Hs="https://emkc.org/api/v2/piston",Fe=Ge.create({baseURL:Hs,headers:{"Content-Type":"application/json"}}),lt=r.createContext(null),Vs=()=>{const t=r.useContext(lt);if(t===null)throw new Error("useRunCode must be used within a RunCodeContextProvider");return t},Gs=({children:t})=>{const{activeFile:n}=q(),[s,o]=r.useState(""),[i,l]=r.useState(""),[c,d]=r.useState(!1),[a,u]=r.useState([]),[g,h]=r.useState({language:"",version:"",aliases:[]});r.useEffect(()=>{(async()=>{var f,b;try{const S=await Fe.get("/runtimes");u(S.data)}catch(S){R.error("Failed to fetch supported languages"),(f=S==null?void 0:S.response)!=null&&f.data&&console.error((b=S==null?void 0:S.response)==null?void 0:b.data)}})()},[]),r.useEffect(()=>{if(a.length===0||!(n!=null&&n.name))return;const p=n.name.split(".").pop();if(p){const f=Ye.languages(p),b=a.find(S=>S.aliases.includes(p)||f.includes(S.language.toLowerCase()));b&&h(b)}else h({language:"",version:"",aliases:[]})},[n==null?void 0:n.name,a]);const m=async()=>{try{if(g)if(n)R.loading("Running code...");else return R.error("Please open a file to run the code");else return R.error("Please select a language to run the code");d(!0);const{language:p,version:f}=g,b=await Fe.post("/execute",{language:p,version:f,files:[{name:n.name,content:n.content}],stdin:s});b.data.run.stderr?l(b.data.run.stderr):l(b.data.run.stdout),d(!1),R.dismiss()}catch(p){console.error(p.response.data),console.error(p.response.data.error),d(!1),R.dismiss(),R.error("Failed to run the code")}};return e.jsx(lt.Provider,{value:{setInput:o,output:i,isRunning:c,supportedLanguages:a,selectedLanguage:g,setSelectedLanguage:h,runCode:m},children:t})};function $s(){const{viewHeight:t}=G(),{setInput:n,output:s,isRunning:o,supportedLanguages:i,selectedLanguage:l,setSelectedLanguage:c,runCode:d}=Vs(),a=g=>{const h=JSON.parse(g.target.value);c(h)},u=()=>{navigator.clipboard.writeText(s),R.success("Output copied to clipboard")};return e.jsxs("div",{className:"flex flex-col items-center gap-2 p-4",style:{height:t},children:[e.jsx("h1",{className:"view-title",children:"Run Code"}),e.jsxs("div",{className:"flex h-[90%] w-full flex-col items-end gap-2 md:h-[92%]",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx("select",{className:"w-full rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",value:JSON.stringify(l),onChange:a,children:i.filter(g=>g.language.toLowerCase()!=="brainfuck").sort((g,h)=>g.language>h.language?1:-1).map((g,h)=>e.jsx("option",{value:JSON.stringify(g),children:g.language+(g.version?` (${g.version})`:"")},h))}),e.jsx(Ve,{size:16,className:"absolute bottom-3 right-4 z-10 text-white"})]}),e.jsx("textarea",{className:"min-h-[120px] w-full resize-none rounded-md border-none bg-darkHover p-2 text-white outline-none",placeholder:"Write you input here...",onChange:g=>n(g.target.value)}),e.jsx("button",{className:"flex w-full justify-center rounded-md bg-primary p-2 font-bold text-black outline-none disabled:cursor-not-allowed disabled:opacity-50",onClick:d,disabled:o,children:"Run"}),e.jsxs("label",{className:"flex w-full justify-between",children:["Output :",e.jsx("button",{onClick:u,title:"Copy Output",children:e.jsx(Se,{size:18,className:"cursor-pointer text-white"})})]}),e.jsx("div",{className:"w-full flex-grow resize-none overflow-y-auto rounded-md border-none bg-darkHover p-2 text-white outline-none",children:e.jsx("code",{children:e.jsx("pre",{className:"text-wrap",children:s})})})]})]})}function De({onChange:t,value:n,options:s,title:o}){return e.jsxs("div",{className:"relative w-full",children:[e.jsx("label",{className:"mb-2",children:o}),e.jsx("select",{className:"w-full rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",value:n,onChange:t,children:s.sort().map(i=>{const l=i,c=i.charAt(0).toUpperCase()+i.slice(1);return e.jsx("option",{value:l,children:c},c)})}),e.jsx(Ve,{size:16,className:"absolute bottom-3 right-4 z-10 text-white"})]})}function ct(){return{setItem:(o,i)=>{localStorage.setItem(o,i)},getItem:o=>localStorage.getItem(o),removeItem:o=>{localStorage.removeItem(o)}}}const dt=r.createContext(null),we=()=>{const t=r.useContext(dt);if(!t)throw new Error("useSettings must be used within a SettingContextProvider");return t},Z={theme:"Dracula",language:"Javascript",fontSize:16,fontFamily:"Space Mono"};function Ys({children:t}){const{getItem:n}=ct(),s=JSON.parse(n("settings")||"{}"),o=s.theme!==void 0?s.theme:Z.theme,i=s.language!==void 0?s.language:Z.language,l=s.fontSize!==void 0?s.fontSize:Z.fontSize,c=s.fontFamily!==void 0?s.fontFamily:Z.fontFamily,[d,a]=r.useState(o),[u,g]=r.useState(i),[h,m]=r.useState(l),[p,f]=r.useState(c),b=()=>{a(Z.theme),g(Z.language),m(Z.fontSize),f(Z.fontFamily)};return r.useEffect(()=>{const S={theme:d,language:u,fontSize:h,fontFamily:p};localStorage.setItem("settings",JSON.stringify(S))},[d,u,h,p]),e.jsx(dt.Provider,{value:{theme:d,setTheme:a,language:u,setLanguage:g,fontSize:h,setFontSize:m,fontFamily:p,setFontFamily:f,resetSettings:b},children:t})}const Js=["Anonymous Pro","Cousine","Fira Code","Inconsolata","JetBrains Mono","Jura","Roboto Mono","Source Code Pro","Space Mono","Ubuntu Mono"],ut={Abcdef:tn,Abyss:nn,"Android Studio":sn,Andromeda:on,"Atom One":rn,Aura:an,"Basic Dark":ln,"Basic Light":cn,BBEdit:dn,Bespin:un,Copilot:mn,Darcula:fn,Dracula:pn,"Duotone Dark":hn,"Duotone Light":gn,Eclipse:xn,"GitHub Dark":Cn,"GitHub Light":wn,"Gruvbox Dark":En,"Gruvbox Light":vn,Kimbie:yn,Material:bn,"Material Dark":jn,"Material Light":Dn,Monokai:Sn,"Monokai Dimmed":Nn,"Noctis Lilac":In,Nord:Ln,Okaidia:Rn,"Quiet Light":kn,Red:Tn,"Solarized Dark":An,"Solarized Light":On,Sublime:_n,"Tokyo Night":Fn,"Tokyo Night Day":Pn,"Tokyo Night Storm":Mn,"Tomorrow Night Blue":Un,"VS Code Dark":zn,"White Dark":Hn,"White Light":Vn,"Xcode Dark":Gn,"Xcode Light":$n};function Ws(){const{theme:t,setTheme:n,language:s,setLanguage:o,fontSize:i,setFontSize:l,fontFamily:c,setFontFamily:d,resetSettings:a}=we(),{viewHeight:u}=G(),g=f=>d(f.target.value),h=f=>n(f.target.value),m=f=>o(f.target.value),p=f=>l(parseInt(f.target.value));return r.useEffect(()=>{const f=document.querySelector(".cm-editor > .cm-scroller");f!==null&&(f.style.fontFamily=`${c}, monospace`)},[c]),e.jsxs("div",{className:"flex flex-col items-center gap-2 p-4",style:{height:u},children:[e.jsx("h1",{className:"view-title",children:"Settings"}),e.jsxs("div",{className:"flex w-full items-end gap-2",children:[e.jsx(De,{onChange:g,value:c,options:Js,title:"Font Family"}),e.jsx("select",{value:i,onChange:p,className:"rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",title:"Font Size",children:[...Array(13).keys()].map(f=>e.jsx("option",{value:f+12,children:f+12},f))})]}),e.jsx(De,{onChange:h,value:t,options:Object.keys(ut),title:"Theme"}),e.jsx(De,{onChange:m,value:s,options:Yn,title:"Language"}),e.jsx("button",{className:"mt-auto w-full rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",onClick:a,children:"Reset to default"})]})}function Bs(){const{users:t}=U();return e.jsx("div",{className:"flex min-h-[200px] flex-grow justify-center overflow-y-auto py-2",children:e.jsx("div",{className:"flex h-full w-full flex-wrap items-start gap-x-2 gap-y-6",children:t.map(n=>e.jsx(qs,{user:n},n.socketId))})})}const qs=({user:t})=>{const{username:n,status:s}=t,o=`${n} - ${s===fe.ONLINE?"online":"offline"}`;return e.jsxs("div",{className:"relative flex w-[100px] flex-col items-center gap-2",title:o,children:[e.jsx(Xn,{name:n,size:"50",round:"12px",title:o}),e.jsx("p",{className:"line-clamp-2 max-w-full text-ellipsis break-words",children:n}),e.jsx("div",{className:`absolute right-5 top-0 h-3 w-3 rounded-full ${s===fe.ONLINE?"bg-green-500":"bg-danger"}`})]})};function Xs(){const t=Ce(),{viewHeight:n}=G(),{setStatus:s}=U(),{socket:o}=V(),i=async()=>{const d=window.location.href;try{await navigator.clipboard.writeText(d),R.success("URL copied to clipboard")}catch(a){R.error("Unable to copy URL to clipboard"),console.log(a)}},l=async()=>{const d=window.location.href;try{await navigator.share({url:d})}catch(a){R.error("Unable to share URL"),console.log(a)}},c=()=>{o.disconnect(),s(H.DISCONNECTED),t("/",{replace:!0})};return e.jsxs("div",{className:"flex flex-col p-4",style:{height:n},children:[e.jsx("h1",{className:"view-title",children:"Users"}),e.jsx(Bs,{}),e.jsx("div",{className:"flex flex-col items-center gap-4 pt-4",children:e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-white p-3 text-black",onClick:l,title:"Share Link",children:e.jsx(_t,{size:26})}),e.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-white p-3 text-black",onClick:i,title:"Copy Link",children:e.jsx(Se,{size:22})}),e.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-primary p-3 text-black",onClick:c,title:"Leave room",children:e.jsx(Ft,{size:22})})]})})]})}const Qs="870775e869b746188acd30e1c5292f60",Ks=({channelName:t,onEndCall:n,isInitiator:s=!1,callerUsername:o=""})=>{const[i,l]=r.useState(null),[c,d]=r.useState(null),[a,u]=r.useState(null),[g,h]=r.useState([]),[m,p]=r.useState(!1),[f,b]=r.useState(!1),[S,L]=r.useState(!1),[A,P]=r.useState(!1),[_,F]=r.useState(!1),[k,ie]=r.useState(!1),[ae,pe]=r.useState(null),[ee,le]=r.useState({x:window.innerWidth-420,y:window.innerHeight-320}),[J,ce]=r.useState({width:400,height:300}),[he,de]=r.useState(!1),[ue,ge]=r.useState({x:0,y:0}),{currentUser:C}=U(),{socket:w}=V(),E=r.useRef(null),y=r.useRef(!1),j=r.useRef({}),D=r.useRef(!1),X=r.useRef(null);r.useEffect(()=>{if(!s){const v=O=>{console.log("Call request received:",O),O.roomId===t&&(console.log("Setting up call notification"),ie(!0))};return w.on(x.VIDEO_CALL_REQUEST,v),()=>{w.off(x.VIDEO_CALL_REQUEST,v)}}},[w,t,s]);const I=async()=>{console.log("Accepting call in VideoCall component"),ie(!1),F(!0),await ve()},Q=()=>{console.log("Rejecting call in VideoCall component"),ie(!1),w.emit(x.VIDEO_CALL_REJECTED,{roomId:t})},ve=async()=>{if(!E.current)try{console.log("Initializing Agora client");const v=xe.createClient({mode:"rtc",codec:"vp8"});E.current=v,v.on("user-published",async(z,K)=>{var se;console.log("User published:",z.uid,K),await v.subscribe(z,K),K==="video"&&h(me=>j.current[z.uid]?me:(j.current[z.uid]=!0,[...me,z])),K==="audio"&&((se=z.audioTrack)==null||se.play())}),v.on("user-unpublished",z=>{console.log("User unpublished:",z.uid)}),v.on("user-left",z=>{console.log("User left:",z.uid),h(K=>K.filter(se=>se.uid!==z.uid)),j.current[z.uid]=!1}),console.log("Joining channel:",t),await v.join(Qs,t,null,null),console.log("Creating local tracks");const[O,te]=await xe.createMicrophoneAndCameraTracks();l(O),d(te),await v.publish([O,te]),y.current=!0,console.log("Local tracks published")}catch(v){console.error("Error initializing Agora client:",v),pe(`Failed to initialize video call: ${v instanceof Error?v.message:String(v)}`)}};r.useEffect(()=>(s&&!_&&(console.log("Starting call as initiator"),F(!0),w.emit(x.VIDEO_CALL_STARTED,{roomId:t,callerUsername:C.username}),ve()),()=>{E.current&&!D.current&&(console.log("Cleaning up resources in initiator effect"),i==null||i.close(),c==null||c.close(),a==null||a.close(),E.current.leave(),E.current=null,y.current=!1,j.current={})}),[s,t,C.username]),r.useEffect(()=>{!s&&_&&!E.current&&(console.log("Initializing call for non-initiator"),ve())},[_,s]),r.useEffect(()=>{const v=O=>{console.log("Call ended event received in VideoCall:",O),O.roomId===t&&(console.log("Cleaning up video call resources"),D.current=!0,i==null||i.close(),c==null||c.close(),a==null||a.close(),E.current&&(E.current.leave(),E.current=null),y.current=!1,j.current={},n())};return w.on(x.VIDEO_CALL_ENDED,v),()=>{w.off(x.VIDEO_CALL_ENDED,v)}},[w,t,i,c,a,n]),r.useEffect(()=>{const v=()=>{A||le(O=>({x:Math.min(O.x,window.innerWidth-J.width),y:Math.min(O.y,window.innerHeight-J.height)}))};return window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[A,J]);const ft=v=>{v.target instanceof HTMLElement&&v.target.closest(".drag-handle")&&(de(!0),ge({x:v.clientX-ee.x,y:v.clientY-ee.y}))},pt=v=>{he&&le({x:v.clientX-ue.x,y:v.clientY-ue.y})},Ie=()=>{de(!1)},ye=(v,O)=>{v.stopPropagation();const te=v.clientX,z=v.clientY,K=J.width,se=J.height,me=Re=>{O.includes("e")&&ce(be=>({...be,width:Math.max(300,K+(Re.clientX-te))})),O.includes("s")&&ce(be=>({...be,height:Math.max(200,se+(Re.clientY-z))}))},Le=()=>{document.removeEventListener("mousemove",me),document.removeEventListener("mouseup",Le)};document.addEventListener("mousemove",me),document.addEventListener("mouseup",Le)},ht=()=>{if(i){const v=!m;i.setEnabled(!v),p(v)}},gt=()=>{if(c){const v=!f;c.setEnabled(!v),b(v)}},xt=()=>{X.current&&(A?(document.exitFullscreen&&document.exitFullscreen(),P(!1)):(X.current.requestFullscreen&&X.current.requestFullscreen(),P(!0)))},Ct=async()=>{if(E.current)try{if(S){a&&(a.stop(),a.close(),u(null));const v=await xe.createCameraVideoTrack();d(v),await E.current.publish(v),L(!1)}else{const v=await xe.createScreenVideoTrack({encoderConfig:"high_quality",optimizationMode:"detail"},"auto");let O;Array.isArray(v)?O=v[0]:O=v,u(O),c&&(c.stop(),c.close(),d(null)),await E.current.publish(v),L(!0)}}catch(v){console.error("Error toggling screen share:",v)}},wt=()=>{console.log("Ending call from VideoCall component"),D.current=!0,i==null||i.close(),c==null||c.close(),a==null||a.close(),E.current&&(E.current.leave(),E.current=null),y.current=!1,j.current={},w.emit(x.VIDEO_CALL_ENDED,{roomId:t}),n()},Et=()=>e.jsxs(We,{open:k,onClose:Q,"aria-labelledby":"call-notification-title",children:[e.jsx(Be,{id:"call-notification-title",children:"Incoming Video Call"}),e.jsx(qe,{children:e.jsxs(W,{children:[o," is calling you. Would you like to join?"]})}),e.jsxs(Xe,{children:[e.jsx($,{onClick:Q,color:"error",children:"Reject"}),e.jsx($,{onClick:I,color:"primary",variant:"contained",children:"Accept"})]})]});return ae?e.jsxs(M,{sx:{p:2,textAlign:"center"},children:[e.jsx(W,{variant:"h6",color:"error",gutterBottom:!0,children:"Error"}),e.jsx(W,{children:ae}),e.jsx($,{variant:"contained",color:"primary",onClick:n,sx:{mt:2},children:"Close"})]}):!_&&!s?e.jsx(Et,{}):e.jsxs(M,{ref:X,sx:{position:A?"fixed":"absolute",top:A?0:ee.y,left:A?0:ee.x,width:A?"100vw":J.width,height:A?"100vh":J.height,bgcolor:"background.paper",borderRadius:1,boxShadow:3,display:"flex",flexDirection:"column",overflow:"hidden",zIndex:1e3,border:"1px solid",borderColor:"divider"},onMouseDown:ft,onMouseMove:pt,onMouseUp:Ie,onMouseLeave:Ie,children:[e.jsxs(M,{className:"drag-handle",sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1,bgcolor:"primary.main",color:"primary.contrastText",cursor:"move"},children:[e.jsxs(M,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Zn,{sx:{mr:1}}),e.jsxs(W,{variant:"subtitle1",children:["Video Call ",s?"(You initiated)":""]})]}),e.jsx(M,{children:e.jsx(es,{size:"small",onClick:xt,sx:{color:"primary.contrastText"},children:A?e.jsx(ts,{}):e.jsx(ns,{})})})]}),e.jsx(M,{sx:{flexGrow:1,overflow:"hidden",position:"relative"},children:e.jsxs(je,{container:!0,spacing:1,sx:{height:"100%",p:1},children:[e.jsx(je,{item:!0,xs:12,md:6,children:e.jsxs(M,{sx:{height:"100%",bgcolor:"black",position:"relative",borderRadius:1,overflow:"hidden"},children:[c&&e.jsx("div",{ref:v=>v&&c.play(v),style:{height:"100%",width:"100%"}}),a&&e.jsx("div",{ref:v=>v&&a.play(v),style:{height:"100%",width:"100%"}}),e.jsxs(W,{variant:"caption",sx:{position:"absolute",bottom:8,left:8,color:"white",bgcolor:"rgba(0,0,0,0.5)",padding:"2px 8px",borderRadius:1},children:["You (",C.username,")"]})]})}),g.map(v=>e.jsx(je,{item:!0,xs:12,md:6,children:e.jsxs(M,{sx:{height:"100%",bgcolor:"black",position:"relative",borderRadius:1,overflow:"hidden"},children:[v.videoTrack&&e.jsx("div",{ref:O=>{var te;return O&&((te=v.videoTrack)==null?void 0:te.play(O))},style:{height:"100%",width:"100%"}}),e.jsx(W,{variant:"caption",sx:{position:"absolute",bottom:8,left:8,color:"white",bgcolor:"rgba(0,0,0,0.5)",padding:"2px 8px",borderRadius:1},children:s?o:C.username})]})},v.uid))]})}),e.jsxs(M,{sx:{p:1,display:"flex",justifyContent:"center",gap:1},children:[e.jsx($,{variant:"contained",color:m?"error":"primary",onClick:ht,startIcon:m?e.jsx(ss,{}):e.jsx(os,{}),size:"small",children:m?"Unmute":"Mute"}),e.jsx($,{variant:"contained",color:f?"error":"primary",onClick:gt,startIcon:f?e.jsx(rs,{}):e.jsx(is,{}),size:"small",children:f?"Start Video":"Stop Video"}),e.jsx($,{variant:"contained",color:S?"secondary":"primary",onClick:Ct,startIcon:S?e.jsx(as,{}):e.jsx(ls,{}),size:"small",children:S?"Stop Sharing":"Share Screen"}),e.jsx($,{variant:"contained",color:"error",onClick:wt,startIcon:e.jsx(cs,{}),size:"small",children:"End Call"})]}),!A&&e.jsxs(e.Fragment,{children:[e.jsx(M,{sx:{position:"absolute",right:0,bottom:0,width:10,height:10,cursor:"se-resize"},onMouseDown:v=>ye(v,"se")}),e.jsx(M,{sx:{position:"absolute",right:0,top:"50%",width:10,height:10,cursor:"e-resize"},onMouseDown:v=>ye(v,"e")}),e.jsx(M,{sx:{position:"absolute",bottom:0,left:"50%",width:10,height:10,cursor:"s-resize"},onMouseDown:v=>ye(v,"s")})]})]})},Zs=()=>{const[t,n]=r.useState(!1),[s,o]=r.useState(!1),[i,l]=r.useState(null),[c,d]=r.useState(!1),[a,u]=r.useState(""),{currentUser:g,currentRoom:h}=U(),{socket:m}=V();r.useEffect(()=>{if(!h)return;const A=k=>{console.log("Call started event received:",k),k.roomId===h.id&&k.callerUsername!==g.username&&(console.log("Setting up call notification for:",k.callerUsername),l(k.callerUsername),d(!0),u(k.callerUsername))},P=k=>{console.log("Call ended event received:",k),k.roomId===h.id&&(console.log("Cleaning up call state"),n(!1),o(!1),l(null),d(!1),u(""))},_=k=>{console.log("Call accepted event received:",k),k.roomId===h.id&&s&&console.log("Call was accepted by:",k.username)},F=k=>{console.log("Call rejected event received:",k),k.roomId===h.id&&s&&(console.log("Call was rejected"),n(!1),o(!1))};return m.on(x.VIDEO_CALL_STARTED,A),m.on(x.VIDEO_CALL_ENDED,P),m.on(x.VIDEO_CALL_ACCEPTED,_),m.on(x.VIDEO_CALL_REJECTED,F),()=>{m.off(x.VIDEO_CALL_STARTED,A),m.off(x.VIDEO_CALL_ENDED,P),m.off(x.VIDEO_CALL_ACCEPTED,_),m.off(x.VIDEO_CALL_REJECTED,F)}},[m,h,g.username,s]);const p=()=>{h&&(console.log("Starting call as initiator"),n(!0),o(!0),m.emit(x.VIDEO_CALL_STARTED,{roomId:h.id,callerUsername:g.username}))},f=()=>{h&&(console.log("Ending call"),n(!1),o(!1),l(null),d(!1),u(""),m.emit(x.VIDEO_CALL_ENDED,{roomId:h.id}))},b=()=>{console.log("Accepting call from:",a),d(!1),n(!0),m.emit(x.VIDEO_CALL_ACCEPTED,{roomId:h==null?void 0:h.id,username:g.username})},S=()=>{console.log("Rejecting call from:",a),d(!1),u(""),m.emit(x.VIDEO_CALL_REJECTED,{roomId:h==null?void 0:h.id})},L=()=>e.jsxs(We,{open:c,onClose:S,"aria-labelledby":"call-notification-title",children:[e.jsx(Be,{id:"call-notification-title",children:"Incoming Video Call"}),e.jsx(qe,{children:e.jsxs(W,{children:[a," is calling you. Would you like to join?"]})}),e.jsxs(Xe,{children:[e.jsx($,{onClick:S,color:"error",children:"Reject"}),e.jsx($,{onClick:b,color:"primary",variant:"contained",children:"Accept"})]})]});return h?t?e.jsx(Ks,{channelName:h.id,onEndCall:f,isInitiator:s,callerUsername:a}):e.jsxs(M,{sx:{p:2,textAlign:"center"},children:[i?e.jsxs(M,{children:[e.jsxs(W,{variant:"h6",gutterBottom:!0,children:[i," has started a video call"]}),e.jsx($,{variant:"contained",color:"primary",onClick:b,startIcon:e.jsx(Ae,{}),children:"Join Call"})]}):e.jsxs(M,{children:[e.jsx(W,{variant:"h6",gutterBottom:!0,children:"Start a video call with your team"}),e.jsx($,{variant:"contained",color:"primary",onClick:p,startIcon:e.jsx(Ae,{}),children:"Start Video Call"})]}),c&&e.jsx(L,{})]}):e.jsx(M,{sx:{p:2,textAlign:"center"},children:e.jsx(W,{children:"Please join a room to start a video call."})})};var N=(t=>(t.HOME="HOME",t.CODE="CODE",t.CHAT="CHAT",t.DOCS="DOCS",t.FILES="FILES",t.CHATS="CHATS",t.CLIENTS="CLIENTS",t.RUN="RUN",t.COPILOT="COPILOT",t.SETTINGS="SETTINGS",t.VIDEO_CALL="VIDEO_CALL",t))(N||{});const mt=r.createContext(null),Ee=()=>{const t=r.useContext(mt);if(!t)throw new Error("useViews must be used within a ViewContextProvider");return t};function eo({children:t}){const{isMobile:n}=re(),[s,o]=r.useState(N.FILES),[i,l]=r.useState(!n),[c]=r.useState({[N.HOME]:e.jsx("div",{children:"Home View"}),[N.CODE]:e.jsx("div",{children:"Code View"}),[N.CHAT]:e.jsx("div",{children:"Chat View"}),[N.DOCS]:e.jsx("div",{children:"Docs View"}),[N.FILES]:e.jsx(zs,{}),[N.CLIENTS]:e.jsx(Xs,{}),[N.SETTINGS]:e.jsx(Ws,{}),[N.COPILOT]:e.jsx(_s,{}),[N.CHATS]:e.jsx(Ss,{}),[N.RUN]:e.jsx($s,{}),[N.VIDEO_CALL]:e.jsx(Zs,{})}),[d]=r.useState({[N.HOME]:e.jsx(Pt,{size:28}),[N.CODE]:e.jsx(Mt,{size:28}),[N.CHAT]:e.jsx(ke,{size:30}),[N.DOCS]:e.jsx(Ut,{size:28}),[N.FILES]:e.jsx(zt,{size:28}),[N.CLIENTS]:e.jsx(Ht,{size:30}),[N.SETTINGS]:e.jsx(Vt,{size:28}),[N.CHATS]:e.jsx(ke,{size:30}),[N.COPILOT]:e.jsx(Gt,{size:28}),[N.RUN]:e.jsx($t,{size:28}),[N.VIDEO_CALL]:e.jsx(Yt,{size:28})});return e.jsx(mt.Provider,{value:{activeView:s,setActiveView:o,isSidebarOpen:i,setIsSidebarOpen:l,viewComponents:c,viewIcons:d},children:t})}function to({children:t}){const{isSidebarOpen:n}=Ee(),{isMobile:s,width:o}=re(),{setItem:i,getItem:l}=ct(),c=()=>{const m=document.createElement("div");return m.className="h-full cursor-e-resizer hidden md:block",m.style.backgroundColor="#e1e1ffb3",m},d=()=>{if(s)return[0,o];const m=l("editorSizes");let p=[35,65];return m&&(p=JSON.parse(m)),n?p:[0,o]},a=()=>s?[0,o]:n?[350,350]:[50,0],u=()=>s?[0,1/0]:n?[1/0,1/0]:[0,1/0],g=m=>{i("editorSizes",JSON.stringify(m))},h=()=>({width:"7px",display:n&&!s?"block":"none"});return e.jsx(ds,{sizes:d(),minSize:a(),gutter:c,maxSize:u(),dragInterval:1,direction:"horizontal",gutterAlign:"center",cursor:"e-resize",snapOffset:30,gutterStyle:h,onDrag:g,className:"flex h-screen min-h-screen max-w-full items-center justify-center overflow-hidden",children:t})}function no(){return e.jsx("div",{className:"flex h-screen min-h-screen flex-col items-center justify-center gap-6 px-4 text-center",children:e.jsx(so,{})})}const so=()=>{const t=Ce(),n=()=>{window.location.reload()},s=()=>{t("/")};return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"whitespace-break-spaces text-lg font-medium text-slate-300",children:"Oops! Something went wrong. Please try again"}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-4",children:[e.jsx("button",{className:"mr-4 rounded-md bg-primary px-8 py-2 font-bold text-black",onClick:n,children:"Try Again"}),e.jsx("button",{className:"rounded-md bg-primary px-8 py-2 font-bold text-black",onClick:s,children:"Go to HomePage"})]})]})},oo={backgroundColor:"#e0e0e0",padding:"8px 12px",borderRadius:"6px",color:"#000",fontSize:"12px",fontWeight:"500",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},Pe={base:"relative flex items-center justify-center rounded transition-colors duration-200 ease-in-out p-2",hover:"hover:bg-[#3D404A]"},ne=({viewName:t,icon:n})=>{const{activeView:s,setActiveView:o,isSidebarOpen:i,setIsSidebarOpen:l}=Ee(),{isNewMessage:c}=Ne(),[d,a]=r.useState(!0),u=g=>{g===s?l(!i):(l(!0),o(g))};return e.jsxs("div",{className:"relative flex flex-col items-center",children:[e.jsxs("button",{onClick:()=>u(t),onMouseEnter:()=>a(!0),className:`${Pe.base} ${Pe.hover}`,...d&&{"data-tooltip-id":`tooltip-${t}`,"data-tooltip-content":t},children:[e.jsx("div",{className:"flex items-center justify-center",children:n}),t===N.CHATS&&c&&e.jsx("div",{className:"absolute right-0 top-0 h-3 w-3 rounded-full bg-primary"})]}),d&&e.jsx(us,{id:`tooltip-${t}`,place:"right",offset:25,className:"!z-50",style:oo,noArrow:!1,positionStrategy:"fixed",float:!0})]})};function ro(){const{activeView:t,isSidebarOpen:n,viewComponents:s,viewIcons:o,setIsSidebarOpen:i}=Ee(),{minHeightReached:l}=G(),{activityState:c,setActivityState:d}=U(),{socket:a}=V(),{isMobile:u}=re(),g=()=>{c===B.CODING?(d(B.DRAWING),a.emit(x.REQUEST_DRAWING)):d(B.CODING),u&&i(!1)};return e.jsxs("aside",{className:"flex w-full md:h-full md:max-h-full md:min-h-full md:w-auto",children:[e.jsxs("div",{className:oe("fixed bottom-0 left-0 z-50 flex h-[50px] w-full gap-4 self-end overflow-hidden border-t border-darkHover bg-dark p-2 md:static md:h-full md:w-[50px] md:min-w-[50px] md:flex-col md:border-r md:border-t-0 md:p-2 md:pt-4",{hidden:l}),children:[e.jsx(ne,{viewName:N.FILES,icon:o[N.FILES]}),e.jsx(ne,{viewName:N.CHATS,icon:o[N.CHATS]}),e.jsx(ne,{viewName:N.COPILOT,icon:o[N.COPILOT]}),e.jsx(ne,{viewName:N.RUN,icon:o[N.RUN]}),e.jsx(ne,{viewName:N.CLIENTS,icon:o[N.CLIENTS]}),e.jsx(ne,{viewName:N.VIDEO_CALL,icon:o[N.VIDEO_CALL]}),e.jsx(ne,{viewName:N.SETTINGS,icon:o[N.SETTINGS]}),e.jsx("div",{className:"flex h-fit items-center justify-center",children:e.jsx("button",{className:"justify-cente flex items-center  rounded p-1.5 transition-colors duration-200 ease-in-out hover:bg-[#3D404A]",onClick:g,"data-tooltip-id":"activity-state-tooltip","data-tooltip-content":c===B.CODING?"Switch to Drawing Mode":"Switch to Coding Mode",children:c===B.CODING?e.jsx(Jt,{size:30}):e.jsx(Wt,{size:30})})})]}),e.jsx("div",{className:"absolute left-0 top-0 z-20 w-full flex-col bg-dark md:static md:min-w-[300px]",style:n?{}:{display:"none"},children:s[t]})]})}function io(){const{isMobile:t}=re();return e.jsx(ms,{inferDarkMode:!0,forceMobile:t,defaultName:"Editor",className:"z-0",children:e.jsx(ao,{})})}function ao(){const t=fs(),{drawingData:n,setDrawingData:s}=U(),{socket:o}=V(),i=r.useCallback(c=>{const d=c.changes;s(t.store.getSnapshot()),o.emit(x.DRAWING_UPDATE,{snapshot:d})},[t.store,s,o]),l=r.useCallback(({snapshot:c})=>{t.store.mergeRemoteChanges(()=>{const{added:d,updated:a,removed:u}=c;for(const g of Object.values(d))t.store.put([g]);for(const[,g]of Object.values(a))t.store.put([g]);for(const g of Object.values(u))t.store.remove([g.id])}),s(t.store.getSnapshot())},[t.store,s]);return r.useEffect(()=>{n&&Object.keys(n).length>0&&t.store.loadSnapshot(n)},[]),r.useEffect(()=>{const c=t.store.listen(i,{source:"user",scope:"document"});return o.on(x.DRAWING_UPDATE,l),()=>{c(),o.off(x.DRAWING_UPDATE)}},[n,t.store,i,l,o]),null}function lo(){const{fontSize:t,setFontSize:n}=we();r.useEffect(()=>{const s=o=>{const i="Changes you made may not be saved";return o.returnValue=i};return window.addEventListener("beforeunload",s),()=>{window.removeEventListener("beforeunload",s)}},[]),r.useEffect(()=>{const s=o=>{if(o.ctrlKey){if(o.preventDefault(),!o.target.closest(".cm-editor"))return;o.deltaY>0?n(Math.max(t-1,12)):n(Math.min(t+1,24))}};return window.addEventListener("wheel",s,{passive:!1}),()=>{window.removeEventListener("wheel",s)}},[t,n])}function co(t){return hs.define({create:()=>Me(t),update(n,s){return!s.docChanged&&!s.selection?n:Me(t)},provide:n=>gs.computeN([n],s=>s.field(n))})}function Me(t){return t.map(n=>{if(!n.typing)return null;let s=n.username;const o=n.cursorPosition;return n&&(s=n.username),{pos:o,above:!0,strictSide:!0,arrow:!0,create:()=>{const i=document.createElement("div");return i.className="cm-tooltip-cursor",i.textContent=s,{dom:i}}}})}const uo=ps.baseTheme({".cm-tooltip.cm-tooltip-cursor":{backgroundColor:"#66b",color:"white",border:"none",padding:"2px 7px",borderRadius:"4px",zIndex:"10","& .cm-tooltip-arrow:before":{borderTopColor:"#66b"},"& .cm-tooltip-arrow:after":{borderTopColor:"transparent"}}});function mo(){const{users:t,currentUser:n}=U(),{activeFile:s,setActiveFile:o}=q(),{theme:i,language:l,fontSize:c}=we(),{socket:d}=V(),{viewHeight:a}=G(),[u,g]=r.useState(setTimeout(()=>{},0)),h=r.useMemo(()=>t.filter(b=>b.username!==n.username),[t,n]),[m,p]=r.useState([]),f=(b,S)=>{var _,F,k;if(!s)return;const L={...s,content:b};o(L);const A=(k=(F=(_=S.state)==null?void 0:_.selection)==null?void 0:F.main)==null?void 0:k.head;d.emit(x.TYPING_START,{cursorPosition:A}),d.emit(x.FILE_UPDATED,{fileId:s.id,newContent:b}),clearTimeout(u);const P=setTimeout(()=>d.emit(x.TYPING_PAUSE),1e3);g(P)};return lo(),r.useEffect(()=>{const b=[Jn,Wn,co(h),uo,xs()],S=Bn(l.toLowerCase());S?b.push(S):R.error("Syntax highlighting is unavailable for this language. Please adjust the editor settings; it may be listed under a different name.",{duration:5e3}),p(b)},[h,l]),e.jsx(qn,{theme:ut[i],onChange:f,value:s==null?void 0:s.content,extensions:m,minHeight:"100%",maxWidth:"100vw",style:{fontSize:c+"px",height:a,position:"relative"}})}const Ue={php:"php",cs:"csharp"};function fo(){const{openFiles:t,closeFile:n,activeFile:s,updateFileContent:o,setActiveFile:i}=q(),l=r.useRef(null),{setLanguage:c}=we(),d=a=>{if((s==null?void 0:s.id)===a)return;o((s==null?void 0:s.id)||"",(s==null?void 0:s.content)||"");const u=t.find(g=>g.id===a);u&&i(u)};return r.useEffect(()=>{const a=l.current;if(!a)return;const u=g=>{g.deltaY>0?a.scrollLeft+=100:a.scrollLeft-=100};return a.addEventListener("wheel",u),()=>{a.removeEventListener("wheel",u)}},[]),r.useEffect(()=>{if((s==null?void 0:s.name)===void 0)return;const a=s.name.split(".").pop();if(!a)return;if(Ue[a]){c(Ue[a]);return}const u=Ye.languages(a);c(u[0])},[s==null?void 0:s.name,c]),e.jsx("div",{className:"flex h-[50px] w-full select-none gap-2 overflow-x-auto p-2 pb-0",ref:l,children:t.map(a=>e.jsxs("span",{className:oe("flex w-fit cursor-pointer items-center rounded-t-md px-2 py-1 text-white",{"bg-darkHover":a.id===(s==null?void 0:s.id)}),onClick:()=>d(a.id),children:[e.jsx($e,{icon:rt(a.name),fontSize:22,className:"mr-2 min-w-fit"}),e.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:a.name,children:a.name}),e.jsx(Bt,{className:"ml-3 inline rounded-md hover:bg-darkHover",size:20,onClick:()=>n(a.id)})]},a.id))})}function po(){const{openFiles:t}=q(),{minHeightReached:n}=G();return t.length<=0?e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx("h1",{className:"text-xl text-white",children:"No file is currently open."})}):e.jsxs("main",{className:oe("flex w-full flex-col overflow-x-auto md:h-screen",{"h-[calc(100vh-50px)]":!n,"h-full":n}),children:[e.jsx(fo,{}),e.jsx(mo,{})]})}function ho(){const{viewHeight:t}=G(),{activityState:n}=U();return e.jsx("div",{className:"absolute left-0 top-0 w-full max-w-full flex-grow overflow-x-hidden md:static",style:{height:t},children:n===B.DRAWING?e.jsx(io,{}):e.jsx(po,{})})}function go(){function t(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(o=>navigator.userAgent.match(o))}const n=t();r.useEffect(()=>{n&&Oe.isEnabled&&Oe.request()},[n])}function xo(){const{setUsers:t}=U(),{socket:n}=V(),s=r.useCallback(()=>{document.visibilityState==="visible"?n.emit(x.USER_ONLINE,{socketId:n.id}):document.visibilityState==="hidden"&&n.emit(x.USER_OFFLINE,{socketId:n.id})},[n]),o=r.useCallback(({socketId:c})=>{t(d=>d.map(a=>a.socketId===c?{...a,status:fe.ONLINE}:a))},[t]),i=r.useCallback(({socketId:c})=>{t(d=>d.map(a=>a.socketId===c?{...a,status:fe.OFFLINE}:a))},[t]),l=r.useCallback(({user:c})=>{t(d=>d.map(a=>a.socketId===c.socketId?c:a))},[t]);r.useEffect(()=>(document.addEventListener("visibilitychange",s),n.on(x.USER_ONLINE,o),n.on(x.USER_OFFLINE,i),n.on(x.TYPING_START,l),n.on(x.TYPING_PAUSE,l),()=>{document.removeEventListener("visibilitychange",s),n.off(x.USER_ONLINE),n.off(x.USER_OFFLINE),n.off(x.TYPING_START),n.off(x.TYPING_PAUSE)}),[n,t,s,o,i,l])}function Co(){var d;xo(),go();const t=Ce(),{roomId:n}=Qn(),{status:s,setCurrentUser:o,currentUser:i}=U(),{socket:l}=V(),c=Je();return r.useEffect(()=>{var u;if(i.username.length>0)return;const a=(u=c.state)==null?void 0:u.username;if(a===void 0)t("/",{state:{roomId:n}});else if(n){const g={username:a,roomId:n};o(g),l.emit(x.JOIN_REQUEST,g)}},[i.username,(d=c.state)==null?void 0:d.username,t,n,o,l]),s===H.CONNECTION_FAILED?e.jsx(no,{}):e.jsxs(to,{children:[e.jsx(ro,{}),e.jsx("div",{className:"flex flex-col h-full",children:e.jsx(ho,{})})]})}const wo="/assets/ill-364CCssw.png",Eo="/assets/new_logo-DbDlARTR.png",vo="data:image/svg+xml,%3csvg%20preserveAspectRatio='none'%20width='384'%20height='366'%20viewBox='0%200%20384%20366'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20vector-effect='non-scaling-stroke'%20d='M32%201H319.453C328.037%201%20336.238%204.5601%20342.1%2010.832L374.648%2045.6545C380.015%2051.3966%20383%2058.9629%20383%2066.8225V334C383%20351.121%20369.121%20365%20352%20365H32C14.8792%20365%201%20351.121%201%20334V32C1%2014.8792%2014.8792%201%2032%201Z'%20stroke='white'%20stroke-opacity='0.15'%20stroke-width='2'/%3e%3cpath%20vector-effect='non-scaling-stroke'%20d='M32%201H319.453C328.037%201%20336.238%204.5601%20342.1%2010.832L374.648%2045.6545C380.015%2051.3966%20383%2058.9629%20383%2066.8225V334C383%20351.121%20369.121%20365%20352%20365H32C14.8792%20365%201%20351.121%201%20334V32C1%2014.8792%2014.8792%201%2032%201Z'%20stroke='url(%23paint0_linear_333_9188)'%20stroke-opacity='0.85'%20stroke-width='2'/%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_333_9188'%20x1='192'%20y1='0'%20x2='192'%20y2='366'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%2333CEFF'/%3e%3cstop%20offset='0.562842'%20stop-color='%23D633FF'%20stop-opacity='0'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",yo=()=>{var m,p;const t=Je(),{currentUser:n,setCurrentUser:s,status:o,setStatus:i}=U(),{socket:l}=V(),c=r.useRef(null),d=Ce(),a=()=>{var f;s({...n,roomId:Y()}),T.success("Created a new Room Id"),(f=c.current)==null||f.focus()},u=f=>{const b=f.target.name,S=f.target.value;s({...n,[b]:S})},g=()=>n.username.trim().length===0?(T.error("Enter your username"),!1):n.roomId.trim().length===0?(T.error("Enter a room id"),!1):n.roomId.trim().length<5?(T.error("ROOM Id must be at least 5 characters long"),!1):n.username.trim().length<3?(T.error("Username must be at least 3 characters long"),!1):!0,h=f=>{f.preventDefault(),o!==H.ATTEMPTING_JOIN&&g()&&(T.loading("Joining room..."),i(H.ATTEMPTING_JOIN),l.emit(x.JOIN_REQUEST,n))};return r.useEffect(()=>{var f;n.roomId.length>0||(f=t.state)!=null&&f.roomId&&(s({...n,roomId:t.state.roomId}),n.username.length===0&&T.success("Enter your username"))},[n,(m=t.state)==null?void 0:m.roomId,s]),r.useEffect(()=>{if(o===H.DISCONNECTED&&!l.connected){l.connect();return}const f=sessionStorage.getItem("redirect")||!1;if(o===H.JOINED&&!f){const b=n.username;sessionStorage.setItem("redirect","true"),d(`/editor/${n.roomId}`,{state:{username:b}})}else o===H.JOINED&&f&&(sessionStorage.removeItem("redirect"),i(H.DISCONNECTED),l.disconnect(),l.connect())},[n,(p=t.state)==null?void 0:p.redirect,d,i,l,o]),e.jsxs("div",{className:"flex w-full max-w-[500px] flex-col items-center justify-center gap-4 p-4 sm:w-[500px] sm:p-8 bg-[#0f0d15]",style:{backgroundImage:`url(${vo})`,backgroundSize:"100% 100%",backgroundRepeat:"no-repeat",padding:"2rem"},children:[e.jsx("img",{src:Eo,alt:"Logo",className:"w-full"}),e.jsxs("form",{onSubmit:h,className:"flex w-full flex-col gap-4",children:[e.jsx("input",{type:"text",name:"roomId",placeholder:"Room Id",className:"w-full rounded-md border border-gray-500 bg-darkHover px-3 py-3 focus:outline-none",onChange:u,value:n.roomId}),e.jsx("input",{type:"text",name:"username",placeholder:"Username",className:"w-full rounded-md border border-gray-500 bg-darkHover px-3 py-3 focus:outline-none",onChange:u,value:n.username,ref:c}),e.jsx("button",{type:"submit",className:"mt-2 w-full rounded-md bg-green-500 px-8 py-3 text-lg font-semibold text-black",children:"Join"})]}),e.jsx("button",{className:"cursor-pointer select-none underline",onClick:a,children:"Generate Unique Room Id"})]})};function bo(){return e.jsx("div",{className:"flex min-h-screen flex-col items-center justify-center gap-16 bg-[#0f0d15]",children:e.jsxs("div",{className:"my-12 flex h-full min-w-full flex-col items-center justify-evenly sm:flex-row sm:pt-0",children:[e.jsx("div",{className:"flex w-full animate-up-down justify-center sm:w-1/2 sm:pl-4",children:e.jsx("img",{src:wo,alt:"CodeChoreo Illustration",className:"mx-auto w-[250px] sm:w-[400px]"})}),e.jsx("div",{className:"flex w-full items-center justify-center sm:w-1/2",children:e.jsx(yo,{})})]})})}const jo=()=>e.jsxs(e.Fragment,{children:[e.jsx(yt,{children:e.jsxs(Kn,{children:[e.jsx(Te,{path:"/",element:e.jsx(bo,{})}),e.jsx(Te,{path:"/editor/:roomId",element:e.jsx(Co,{})})]})}),e.jsx(Cs,{})]});function Do({children:t}){return e.jsx(ws,{children:e.jsx(vs,{children:e.jsx(Ys,{children:e.jsx(eo,{children:e.jsx(Os,{children:e.jsx(Rs,{children:e.jsx(Gs,{children:e.jsx(ys,{children:t})})})})})})})})}vt.createRoot(document.getElementById("root")).render(e.jsx(Do,{children:e.jsx(jo,{})}));
